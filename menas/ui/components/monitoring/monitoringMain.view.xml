<!--
  ~ Copyright 2018-2019 ABSA Group Limited
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
  -->

<core:View id="monitoringMainView" controllerName="components.monitoring.monitoringMain"
           xmlns="sap.m"
           xmlns:core="sap.ui.core"
           xmlns:mvc="sap.ui.core.mvc"
           xmlns:layout="sap.ui.layout"
           xmlns:u="sap.ui.unified"
           xmlns:form="sap.ui.layout.form"
           xmlns:table="sap.ui.table"
		   xmlns:cust="http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1"
		   xmlns:html="http://www.w3.org/1999/xhtml"
           xmlns:lab="it.designfuture.chartjs"
           xmlns:tnt="sap.tnt"
           class="viewPadding">
	<Page title="Monitoring" enableScrolling="true">
		<customHeader>
			<Bar>
				<contentMiddle>
					<Title text="Monitoring"/>
				</contentMiddle>
				<contentRight>
					<Text text="Logged in as:"/>
					<Text text="{/userInfo/username}"/>
					<Button id="logout" icon="sap-icon://log" press="GenericService.logout"/>
				</contentRight>
			</Bar>
		</customHeader>
		<content>
			<SplitContainer>
				<masterPages>
					<Page showHeader="false">
						<content>
							<List items="{/datasets}" mode="SingleSelectMaster" selectionChange="datasetSelected">
								<StandardListItem title="{_id}" description="latest version: {latestVersion}" cust:id="{_id}" type="Active">
								</StandardListItem>
							</List>
						</content>
						<footer>
                            <Bar>
                                <contentRight>
                                    <Text text="{/currentDataset/name}" wrapping="false" />
                                </contentRight>
                            </Bar>
						</footer>
					</Page>
				</masterPages>
				<detailPages>
					<Page>
						<customHeader>
							<Bar>
								<contentLeft>
									<Title text="{/datasetId} From: {/dateFrom} To: {/dateTo}    {/numberOfPoints} runs"  />
								</contentLeft>
							</Bar>
						</customHeader>
                            <content>
                                    <layout:BlockLayout id="BlockLayout">
                                    <layout:BlockLayoutRow>
                                        <layout:BlockLayoutCell
                                            title="Info date interval"
                                            titleAlignment="Center"
                                            width="50rem">
                                            <u:Calendar
                                                id="calendar"
                                                select="handleCalendarSelect"
                                                intervalSelection="true"
                                                weekNumberSelect="handleWeekNumberSelect"/>
                                        </layout:BlockLayoutCell>

                                        <layout:BlockLayoutCell
                                            title="Runs by status"
                                            titleAlignment="Center"
                                            width="50rem">
                                            <lab:PieChartJS
                                                id="Status_of_runs"
                                                datasets="{/pieChartStatusTotals/datasets}"
                                                labels="{/pieChartStatusTotals/labels}"
                                                titleDisplay="false"
                                                titleText=""
                                                tooltipEnabled="true">
                                            </lab:PieChartJS>
                                        </layout:BlockLayoutCell>

                                        <layout:BlockLayoutCell
                                            title="Records by status"
                                            titleAlignment="Center"
                                            width="50rem">
                                            <lab:PieChartJS
                                                id="record_totals"
                                                datasets="{/pieChartRecordTotals/datasets}"
                                                labels="{/pieChartRecordTotals/labels}"
                                                titleDisplay="false"
                                                titleText=""
                                                tooltipEnabled="true">
                                            </lab:PieChartJS>
                                        </layout:BlockLayoutCell>
                                    </layout:BlockLayoutRow>
                                    </layout:BlockLayout>

                                <FlexBox id="bar-chart-FlexBox" width="100%" height="{/barChartHeight}">
                                    <lab:BarChartJS
                                        id="bar_chart"
                                        datasets="{/barChartData/datasets}"
                                        labels="{/barChartData/labels}"
                                        titleDisplay="true"
                                        titleText="Records per run"
                                        tooltipEnabled="true"
                                        isHorizontal="true"
                                        maintainAspectRatio="false">
                                    </lab:BarChartJS>
                                </FlexBox>

                                <table:Table
                                    rows="{/monitoringRunData}"
                                    title="Run details"
                                    selectionMode="None"
                                    alternateRowColors="true"
                                    showColumnVisibilityMenu="true"
                                    visibleRowCountMode="Fixed"
                                    visibleRowCount="{/numberOfPoints}"
                                    width="100%">
                                    <table:columns>
                                        <table:Column id="multiheader-info" width="6rem" >
                                            <table:multiLabels>
                                                <Label text="Information" textAlign="Center" width="100%"/>
                                                <Label text="Date" textAlign="Center" width="100%"/>
                                            </table:multiLabels>
                                            <table:template>
                                                <Text text="{informationDate}" wrapping="false" />
                                            </table:template>
                                        </table:Column>
                                        <table:Column width="5rem">
                                            <table:multiLabels>
                                                <Label text="Information"/>
                                                <Label text="Version" textAlign="Center" width="100%"/>
                                            </table:multiLabels>
                                            <table:template>
                                                <Text text="{reportVersion}" wrapping="false" />
                                            </table:template>

                                        </table:Column>
                                        <table:Column width="5rem">
                                            <Label text="Dataset version"  textAlign="Center" width="100%" wrapping="true"/>
                                            <table:template>
                                                <Text text="{datasetVersion}" wrapping="false" />
                                            </table:template>
                                        </table:Column>

                                        <table:Column width="10rem">
                                            <Label text="Status"  textAlign="Center" width="100%" />
                                            <table:template>
                                                <tnt:InfoLabel
                                                    text="{status}"
                                                    colorScheme= "{infoLabel}"/>
                                            </table:template>
                                        </table:Column>

                                        <table:Column id="multiheader-checkpoint" width="12rem">
                                            <table:multiLabels>
                                                <Label text="Latest checkpoint" textAlign="Center" width="100%"/>
                                                <Label text="End timestamp" textAlign="Center" width="100%"/>
                                            </table:multiLabels>
                                            <table:template>
                                                <Text text="{latestCheckpoint/0/processEndTime}" wrapping="false" />
                                            </table:template>
                                        </table:Column>
                                        <table:Column width="7rem" visible="false">
                                            <table:multiLabels>
                                                <Label text="Latest checkpoint" />
                                                <Label text="Stage" textAlign="Center" width="100%"/>
                                            </table:multiLabels>
                                            <table:template>
                                                <Text text="{latestCheckpoint/0/workflowName}" wrapping="false" />
                                            </table:template>
                                        </table:Column>
                                        <table:Column width="10rem">
                                            <table:multiLabels>
                                                <Label text="Latest checkpoint"/>
                                                <Label text="Name" textAlign="Center" width="100%"/>
                                            </table:multiLabels>
                                            <table:template>
                                                <Text text="{latestCheckpoint/0/name}" wrapping="false" />
                                            </table:template>
                                        </table:Column>

                                        <table:Column id="multiheader-recordcount-raw" width="5rem">
                                            <table:multiLabels>
                                                <Label text="Records" textAlign="Center" width="100%" />
                                                <Label text="Raw" textAlign="Center" width="100%" />
                                                <Label text="Total" textAlign="Center" width="100%" />
                                            </table:multiLabels>
                                            <table:template>
                                                <Text text="{raw_recordcount}" wrapping="false" />
                                            </table:template>
                                        </table:Column>
                                        <table:Column id="multiheader-recordcount-std" width="7rem">
                                            <table:multiLabels>
                                                <Label text="Records" />
                                                <Label text="Standardization" textAlign="Center" width="100%" />
                                                <Label text="Succeded" textAlign="Center" width="100%" />
                                            </table:multiLabels>
                                            <table:template>
                                                <Text text="{std_records_succeeded}" wrapping="false" />
                                            </table:template>
                                        </table:Column>
                                        <table:Column width="5rem">
                                            <table:multiLabels>
                                                <Label text="Records" />
                                                <Label text="Standardization" />
                                                <Label text="Failed" textAlign="Center" width="100%" />
                                            </table:multiLabels>
                                            <table:template>
                                                <Text text="{std_records_failed}" wrapping="false" />
                                            </table:template>
                                        </table:Column>
                                        <table:Column id="multiheader-recordcount-cnfrm" width="7rem">
                                            <table:multiLabels>
                                                <Label text="Records" />
                                                <Label text="Conformance" textAlign="Center" width="100%" />
                                                <Label text="Succeded" textAlign="Center" width="100%" />
                                            </table:multiLabels>
                                            <table:template>
                                                <Text text="{conform_records_succeeded}" wrapping="false" />
                                            </table:template>
                                        </table:Column>
                                        <table:Column width="5rem">
                                            <table:multiLabels>
                                                <Label text="Records" />
                                                <Label text="Conformance" />
                                                <Label text="Failed" textAlign="Center" width="100%" />
                                            </table:multiLabels>
                                            <table:template>
                                                <Text text="{conform_records_failed}" wrapping="false" />
                                            </table:template>
                                        </table:Column>
                                    </table:columns>
                                </table:Table>

                            </content>
						<footer>
                            <Bar>
                                <contentRight>
                                    <Text text="dataset: {/currentDataset/name} latest version: {/currentDataset/version}" wrapping="false" />
                                </contentRight>
                            </Bar>
						</footer>
					</Page>
				</detailPages>
			</SplitContainer>
		</content>
	</Page>
</core:View>
